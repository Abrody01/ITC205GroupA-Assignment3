import bcccp.carpark.CarSensor;
import bcccp.carpark.Carpark;
import bcccp.carpark.IGate;
import bcccp.carpark.entry.EntryController;
import bcccp.carpark.entry.IEntryUI;
import bcccp.tickets.adhoc.AdhocTicket;
import bcccp.tickets.adhoc.IAdhocTicket;
import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertTrue;
import static org.junit.Assert.fail;
import org.junit.Before;
import org.junit.FixMethodOrder;
import org.junit.Test;
import org.junit.runners.MethodSorters;
import static org.mockito.ArgumentMatchers.contains;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.verify;
import static org.mockito.Mockito.when;
/**
 *
 * @author Collin McKeahnie
 */
@FixMethodOrder(MethodSorters.NAME_ASCENDING)
public class EntryControllerTest {
    
            Carpark mockCarpark;
            IGate mockGate;
            CarSensor mockIS;
            CarSensor mockOS;
            IEntryUI mockUI;
            IAdhocTicket mockTicket;
            EntryController mockEntry;
            
            
            
    @Before
	public void setUp() {
            mockCarpark = mock(Carpark.class);
            mockGate = mock(IGate.class);
            mockIS = mock(CarSensor.class);
            mockOS = mock(CarSensor.class);
            mockUI = mock(IEntryUI.class);
            mockTicket = mock(IAdhocTicket.class);
            mockEntry = new EntryController(mockCarpark, mockGate, mockOS, mockIS, mockUI);
            
	}
    
    @Test    
    public void initialisationTest() {
        assertTrue(mockEntry instanceof EntryController);
        assertTrue(mockIS instanceof CarSensor);
        assertTrue(mockOS instanceof CarSensor);
        assertEquals(mockEntry.getSTATE().toString(), "IDLE");
    }
    
    @Test
    public void transitionTestFromIDLEtoWAITING() {        
    	
    	assertEquals(mockEntry.getSTATE().toString(), "IDLE");//verify initial state
        
    	//transition from IDLE to WAITING
    	when(mockOS.carIsDetected()).thenReturn(true);
        when(mockOS.getId()).thenReturn("Entry Outside Sensor"); 
        mockEntry.carEventDetected("Entry Outside Sensor", true);
        
        verify(mockUI).display((contains("Push Button")));
        assertEquals(mockEntry.getSTATE().toString(), "WAITING"); //verify transition state        
    }
    
    
    @Test
    public void transitionTestFromIDLEtoBLOCKED() {
        //from IDLE to BLOCKED
    	
    	 assertEquals(mockEntry.getSTATE().toString(), "IDLE");//verify initial state
    	
        when(mockOS.carIsDetected()).thenReturn(true);
        when(mockOS.getId()).thenReturn("Entry Outside Sensor"); 
        mockEntry.carEventDetected("Entry Outside Sensor", true);
        
        when(mockIS.carIsDetected()).thenReturn(true);
        when(mockIS.getId()).thenReturn("Entry Inside Sensor");
        mockEntry.carEventDetected("Entry Inside Sensor", true);
        
        assertEquals(mockEntry.getSTATE().toString(), "BLOCKED");//verify transition state 
        
    }
    
    @Test
    public void transitionTestFromWAITINGtoIDLE() {
        //from WAITING to IDLE
        when(mockOS.carIsDetected()).thenReturn(true);
        when(mockOS.getId()).thenReturn("Entry Outside Sensor");
        mockEntry.carEventDetected("Entry Outside Sensor", true);
        
        assertEquals(mockEntry.getSTATE().toString(), "WAITING"); //verify initial state  
        
        when(mockOS.carIsDetected()).thenReturn(false);
        when(mockOS.getId()).thenReturn("Entry Outside Sensor");    
        mockEntry.carEventDetected("Entry Outside Sensor", false);
        
        assertEquals(mockEntry.getSTATE().toString(), "IDLE");//verify transition state 
        
    }
    
    @Test
    public void transitionTestFromWAITINGtoBLOCKED() {        
        //from WAITING to BLOCKED
        when(mockOS.carIsDetected()).thenReturn(true);
        when(mockOS.getId()).thenReturn("Entry Outside Sensor");      
        mockEntry.carEventDetected("Entry Outside Sensor", true);
        
        assertEquals(mockEntry.getSTATE().toString(), "WAITING"); //verify initial state
        
        when(mockIS.carIsDetected()).thenReturn(true);
        when(mockIS.getId()).thenReturn("Entry Inside Sensor");
        mockEntry.carEventDetected("Entry Inside Sensor", true);
        
        assertEquals(mockEntry.getSTATE().toString(), "BLOCKED");//verify transition state 
    }
    
    @Test
    public void transitionTestFromBLOCKEDtoIDLE() {        
        //from BLOCKED to IDLE
        when(mockOS.carIsDetected()).thenReturn(true);
        when(mockOS.getId()).thenReturn("Entry Outside Sensor");
        mockEntry.carEventDetected("Entry Outside Sensor", true);
        
        when(mockIS.carIsDetected()).thenReturn(true);
        when(mockIS.getId()).thenReturn("Entry Inside Sensor");
        mockEntry.carEventDetected("Entry Inside Sensor", true);
        
        assertEquals(mockEntry.getSTATE().toString(), "BLOCKED");//verify initial state
        
        when(mockOS.carIsDetected()).thenReturn(false);
        when(mockOS.getId()).thenReturn("Entry Outside Sensor");
        mockEntry.carEventDetected("Entry Outside Sensor", false);
        
        assertEquals(mockEntry.getSTATE().toString(), "IDLE");//verify transition state 
    }
    
        
    @Test
    public void transitionTestFromBLOCKEDtoPreviousState() {   
        //from BLOCKED to previous state
        when(mockOS.carIsDetected()).thenReturn(true);
        when(mockOS.getId()).thenReturn("Entry Outside Sensor");
        mockEntry.carEventDetected("Entry Outside Sensor", true);
        
        when(mockIS.carIsDetected()).thenReturn(true);
        when(mockIS.getId()).thenReturn("Entry Inside Sensor");
        mockEntry.carEventDetected("Entry Inside Sensor", true);
        
        assertEquals(mockEntry.getSTATE().toString(), "BLOCKED");//verify initial state
        
        when(mockIS.carIsDetected()).thenReturn(false);
        when(mockIS.getId()).thenReturn("Entry Inside Sensor");
        mockEntry.carEventDetected("Entry Inside Sensor", false);
        
        assertEquals(mockEntry.getSTATE().toString(), "WAITING");//verify transition state     
    }
        
    @Test
    public void transitionTestFromTAKENtoIDLE() {
        //from TAKEN to IDLE
        when(mockOS.carIsDetected()).thenReturn(true);
        when(mockOS.getId()).thenReturn("Entry Outside Sensor");
        mockEntry.carEventDetected("Entry Outside Sensor", true);
        
        when(mockCarpark.issueAdhocTicket()).thenReturn(mockTicket);
        mockEntry.buttonPushed();
        mockEntry.ticketTaken();
        assertEquals(mockEntry.getSTATE().toString(), "TAKEN");//verify initial state
        
        when(mockOS.carIsDetected()).thenReturn(false);
        when(mockOS.getId()).thenReturn("Entry Outside Sensor");
        mockEntry.carEventDetected("Entry Outside Sensor", false);
        
        assertEquals(mockEntry.getSTATE().toString(), "IDLE");//verify transition state
    }
     
    @Test
    public void transitionTestFromTAKENtoENTERING() {
        //from TAKEN to ENTERING
        when(mockOS.carIsDetected()).thenReturn(true);
        when(mockOS.getId()).thenReturn("Entry Outside Sensor");
        mockEntry.carEventDetected("Entry Outside Sensor", true);
        
        when(mockCarpark.issueAdhocTicket()).thenReturn(mockTicket);
        mockEntry.buttonPushed();
        mockEntry.ticketTaken();
        assertEquals(mockEntry.getSTATE().toString(), "TAKEN");//verify initial state
        
        when(mockIS.carIsDetected()).thenReturn(true);
        when(mockIS.getId()).thenReturn("Entry Inside Sensor");
        mockEntry.carEventDetected("Entry Inside Sensor", true);
        
        assertEquals(mockEntry.getSTATE().toString(), "ENTERING");//verify transition state
    }
    
    @Test
    public void transitionTestFromENTERINGtoENTERED() {
        //from ENTERING to ENTERED
        when(mockOS.carIsDetected()).thenReturn(true);
        when(mockOS.getId()).thenReturn("Entry Outside Sensor");
        mockEntry.carEventDetected("Entry Outside Sensor", true);
        
        when(mockCarpark.issueAdhocTicket()).thenReturn(mockTicket);
        mockEntry.buttonPushed();
        mockEntry.ticketTaken();
        
        when(mockIS.carIsDetected()).thenReturn(true);
        when(mockIS.getId()).thenReturn("Entry Inside Sensor");
        mockEntry.carEventDetected("Entry Inside Sensor", true);
        
        assertEquals(mockEntry.getSTATE().toString(), "ENTERING");//verify initial state;
        
        when(mockOS.carIsDetected()).thenReturn(false);
        when(mockOS.getId()).thenReturn("Entry Outside Sensor");
        mockEntry.carEventDetected("Entry Outside Sensor", false);
        
        assertEquals(mockEntry.getSTATE().toString(), "ENTERED");//verify transition state
    }
    
    @Test
    public void transitionTestFromENTERINGtoTAKEN() {
        //from ENTERING to TAKEN
        when(mockOS.carIsDetected()).thenReturn(true);
        when(mockOS.getId()).thenReturn("Entry Outside Sensor");
        mockEntry.carEventDetected("Entry Outside Sensor", true);
        
        when(mockCarpark.issueAdhocTicket()).thenReturn(mockTicket);
        mockEntry.buttonPushed();
        mockEntry.ticketTaken();
        
        when(mockIS.carIsDetected()).thenReturn(true);
        when(mockIS.getId()).thenReturn("Entry Inside Sensor");
        mockEntry.carEventDetected("Entry Inside Sensor", true);
        
        assertEquals(mockEntry.getSTATE().toString(), "ENTERING");//verify initial state
        
        when(mockIS.carIsDetected()).thenReturn(false);
        when(mockIS.getId()).thenReturn("Entry Inside Sensor");
        mockEntry.carEventDetected("Entry Inside Sensor", false);
        
        assertEquals(mockEntry.getSTATE().toString(), "TAKEN");//verify transition state
    }
    
    @Test
    public void transitionTestFromENTEREDtoIDLE() {
        //from ENTERED to IDLE
        when(mockOS.carIsDetected()).thenReturn(true);
        when(mockOS.getId()).thenReturn("Entry Outside Sensor");
        mockEntry.carEventDetected("Entry Outside Sensor", true);
        
        when(mockCarpark.issueAdhocTicket()).thenReturn(mockTicket);
        mockEntry.buttonPushed();
        mockEntry.ticketTaken();
        when(mockIS.carIsDetected()).thenReturn(true);
        when(mockIS.getId()).thenReturn("Entry Inside Sensor");
        mockEntry.carEventDetected("Entry Inside Sensor", true);
        
        when(mockOS.carIsDetected()).thenReturn(false);
        when(mockOS.getId()).thenReturn("Entry Outside Sensor");
        mockEntry.carEventDetected("Entry Outside Sensor", false);
        
        assertEquals(mockEntry.getSTATE().toString(), "ENTERED");//verify initial state
        
        when(mockIS.carIsDetected()).thenReturn(false);
        when(mockIS.getId()).thenReturn("Entry Inside Sensor");
        mockEntry.carEventDetected("Entry Inside Sensor", false);
        
        when(mockGate.isRaised()).thenReturn(false);
        assertEquals(mockEntry.getSTATE().toString(), "IDLE");//verify transition state
    }
    
    @Test
    public void transitionTestFromENTEREDtoENTERING() {    
        //from ENTERED to ENTERING
        when(mockOS.carIsDetected()).thenReturn(true);
        when(mockOS.getId()).thenReturn("Entry Outside Sensor");
        mockEntry.carEventDetected("Entry Outside Sensor", true);
        
        when(mockCarpark.issueAdhocTicket()).thenReturn(mockTicket);
        mockEntry.buttonPushed();
        mockEntry.ticketTaken();
       
        when(mockIS.carIsDetected()).thenReturn(true);
        when(mockIS.getId()).thenReturn("Entry Inside Sensor");
        mockEntry.carEventDetected("Entry Inside Sensor", true);
        
        when(mockOS.carIsDetected()).thenReturn(false);
        when(mockOS.getId()).thenReturn("Entry Outside Sensor");
        mockEntry.carEventDetected("Entry Outside Sensor", false);
        
        assertEquals(mockEntry.getSTATE().toString(), "ENTERED");//verify initial state
        
        when(mockOS.carIsDetected()).thenReturn(true);
        when(mockOS.getId()).thenReturn("Entry Outside Sensor");
        mockEntry.carEventDetected("Entry Outside Sensor", true);
        
        assertEquals(mockEntry.getSTATE().toString(), "ENTERING");//verify transition state
        
    }
    
    
    @Test(expected=AssertionError.class)
    public void testNullConstructorParam1() {
        mockEntry = new EntryController(null, mockGate, mockIS, mockOS, mockUI);
        fail("Exception should be thrown.");
    }
    
    @Test(expected=NullPointerException.class)
    public void testNullConstructorParam2() {
    	mockEntry = new EntryController(mockCarpark, null, mockIS, mockOS, mockUI);
        fail("Exception should be thrown.");
    }
    
    @Test(expected=NullPointerException.class)
    public void testNullConstructorParam3() {
    	mockEntry = new EntryController(mockCarpark, mockGate, null, mockOS, mockUI);
        fail("Exception should be thrown.");
    }
    
    @Test(expected=NullPointerException.class)
    public void testNullConstructorParam4() {
    	mockEntry = new EntryController(mockCarpark, mockGate, mockIS, null, mockUI);
        fail("Exception should be thrown.");
    }
    
    @Test(expected=NullPointerException.class)
    public void testNullConstructorParam5() {
    	mockEntry = new EntryController(mockCarpark, mockGate, mockIS, mockOS, null);
        fail("Exception should be thrown.");
    }
  
}
